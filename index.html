<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Apertura de Historia Clínica | HDSA</title>
    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <!-- Estilos Personalizados -->
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container py-4">
        <div class="card form-card">
            <div class="form-header-custom position-relative">
                <!-- Encabezado Institucional -->
                <table class="table table-bordered border-dark mb-0" style="font-size: 0.8rem;">
                    <tbody>
                        <tr>
                            <td rowspan="4" class="text-center align-middle" style="width: 22%;">
                                <!-- Asegúrate de tener la imagen o usa un placeholder -->
                                <img src="Logo_HDSA.jpg" alt="Logo HDSA" class="img-fluid" style="max-height: 110px;">
                            </td>
                            <td rowspan="2" class="text-center align-middle fw-bold">
                                HOSPITAL DEPARTAMENTAL SAN ANTONIO DE ROLDANILLO
                            </td>
                            <td class="text-center align-middle" style="width: 30%;"><strong>CÓDIGO: </strong>GI-SI-FO-18 </td>
                        </tr>
                        <tr>
                            <td class="text-center align-middle"><strong>VERSIÓN:</strong> 1</td>
                        </tr>
                        <tr>
                            <td rowspan="2" class="text-center align-middle fw-bold">
                                GESTIÓN DE TECNOLOGÍA E INFORMÁTICA<br>
                                <span class="text-uppercase text-primary">Solicitud Apertura de Historia Clínica (SIHOS)</span>
                            </td>
                            <td class="text-center align-middle"><strong>PÁGINA:</strong> 1 de 1</td>
                        </tr>
                        <tr>
                            <td class="text-center align-middle"><strong>FECHA: </strong> 13/02/2026</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <div class="card-body p-3 p-md-4">
                <!-- Alerta Informativa -->
                <div class="alert alert-info d-flex align-items-center shadow-sm" role="alert">
                    <i class="bi bi-info-circle-fill fs-4 me-3"></i>
                    <div>
                        <strong>Importante:</strong> Este formulario es exclusivo para solicitar la reapertura de historias clínicas cerradas en SIHOS.
                    </div>
                </div>

                <!-- Botón Manual de Usuario (Movido aquí) -->
                <div class="d-flex justify-content-end mb-3">
                    <button type="button" class="btn btn-sm btn-outline-primary" data-bs-toggle="modal" data-bs-target="#manualModal">
                        <i class="bi bi-book-half me-1"></i> Manual de Usuario
                    </button>
                </div>

                <form id="aperturaForm">
                    <!-- 1. Datos de la Solicitud y Responsables -->
                    <h5 class="section-title"><i class="bi bi-person-badge me-2"></i>Datos del Solicitante y Responsable</h5>
                    <div class="row g-3 mb-3">
                        <div class="col-md-4">
                            <label class="form-label small text-muted fw-bold">Fecha de Solicitud</label>
                            <input type="date" class="form-control" name="fecha_solicitud" id="fechaSolicitud" required readonly>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label small text-muted fw-bold">Solicitante (Quien pide la apertura) <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" name="solicitante" placeholder="Nombre del funcionario" required>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label small text-muted fw-bold">Profesional Responsable de Atención <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" name="profesional_responsable" placeholder="Médico/Enfermera que prestó la atención" required>
                        </div>
                    </div>

                    <!-- 2. Datos del Paciente -->
                    <h5 class="section-title"><i class="bi bi-person-vcard me-2"></i>Información del Paciente</h5>
                    <div class="row g-3 mb-3">
                        <div class="col-md-3">
                            <label class="form-label small text-muted fw-bold">N° Identificación <span class="text-danger">*</span></label>
                            <input type="text" inputmode="numeric" pattern="[0-9]*" class="form-control" name="paciente_id" placeholder="Cédula / TI" required>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label small text-muted fw-bold">Nombre del Paciente <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" name="paciente_nombre" required>
                        </div>
                        <div class="col-md-2">
                            <label class="form-label small text-muted fw-bold">N° de Admisión (SIHOS) <span class="text-danger">*</span></label>
                            <input type="text" inputmode="numeric" pattern="[0-9]*" class="form-control" name="numero_admision" placeholder="Ej: 105430" required>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label small text-muted fw-bold">Fecha de Atención <span class="text-danger">*</span></label>
                            <input type="date" class="form-control" name="fecha_atencion_paciente" required>
                        </div>
                    </div>
 
                    <!-- 3. Detalle -->
                    <h5 class="section-title"><i class="bi bi-file-text me-2"></i>Motivo de la Apertura</h5>
                    <div class="mb-4">
                        <label class="form-label small text-muted fw-bold">Descripción de la solicitud <span class="text-danger">*</span></label>
                        <textarea class="form-control" name="descripcion" rows="3" placeholder="Justifique por qué se requiere abrir la historia (Ej: Nota aclaratoria, evolución faltante, error en registro)..." required></textarea>
                    </div>

                    <!-- Panel de Tabla de Seguimiento (Movido aquí por solicitud) -->
                    <div id="panelSeguimiento" class="d-none mb-4 bg-light p-3 rounded border">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h5 class="text-primary fw-bold"><i class="bi bi-table me-2"></i>Seguimiento de Solicitudes</h5>
                            <button type="button" id="btnCerrarTabla" class="btn btn-sm btn-outline-secondary">
                                <i class="bi bi-x-lg"></i> Cerrar
                            </button>
                        </div>

                        <!-- Filtros (Solo visibles para Robert/Admin) -->
                        <div id="containerFiltros" class="row g-2 mb-3 d-none bg-white p-2 rounded border">
                            <div class="col-md-auto d-flex align-items-center">
                                <span class="fw-bold small text-primary"><i class="bi bi-funnel-fill"></i> Filtros Admin:</span>
                            </div>
                            <div class="col-md-3">
                                <select id="filtroEstado" class="form-select form-select-sm border-primary">
                                    <option value="Todos">Todos los estados</option>
                                    <option value="Pendiente">Pendiente</option>
                                    <option value="Realizado">Realizado</option>
                                    <option value="Rechazado">Rechazado</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <input type="date" id="filtroFecha" class="form-control form-control-sm border-primary">
                            </div>
                        </div>

                        <div class="table-responsive">
                            <table class="table table-hover table-bordered table-sm bg-white" style="font-size: 0.85rem;">
                                <thead class="table-primary">
                                    <tr>
                                        <th>Fecha Sol.</th>
                                        <th>Paciente</th>
                                        <th>Admisión</th>
                                        <th>Solicitante</th>
                                        <th>Responsable Atención</th>
                                        <th>Estado</th>
                                        <th>Gestionado Por</th>
                                    </tr>
                                </thead>
                                <tbody id="tablaCuerpo">
                                    <!-- Datos de ejemplo -->
                                    <tr>
                                        <td>2026-02-11</td>
                                        <td>Juan Pérez (111222333)</td>
                                        <td>105400</td>
                                        <td>Enf. Jefe Maria</td>
                                        <td>Dr. Carlos Ruiz</td>
                                        <td><span class="badge bg-success">Realizado</span></td>
                                        <td>Robert Giraldo</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- 4. Módulo de Gestión (Oculto para usuarios normales, visible para Admin) -->
                    <div id="moduloGestion" class="d-none mt-4 p-4 rounded position-relative bg-admin">
                        <span class="position-absolute top-0 start-50 translate-middle badge rounded-pill bg-warning text-dark border border-light shadow-sm">
                            <i class="bi bi-gear-fill me-1"></i>Gestión Interna (Sistemas)
                        </span>
                        
                        <div class="row g-3 mt-1">
                            <div class="col-md-4">
                                <label class="form-label fw-bold small text-dark">Gestionado Por:</label>
                                <select class="form-select border-warning" id="gestionadoPor">
                                    <option value="" selected>Seleccione...</option>
                                    <!-- Opciones se llenan dinámicamente con JS -->
                                </select>
                            </div>
                            <div class="col-md-4">
                                <label class="form-label fw-bold small text-dark">Fecha de Atención:</label>
                                <input type="datetime-local" class="form-control border-warning" id="fechaAtencion">
                            </div>
                            <div class="col-md-4">
                                <label class="form-label fw-bold small text-dark">Estado:</label>
                                <select class="form-select border-warning" id="estadoSolicitud">
                                    <option value="Pendiente">Pendiente</option>
                                    <option value="Realizado">Realizado / Abierta</option>
                                    <option value="Rechazado">Rechazado</option>
                                </select>
                            </div>
                            <div class="col-12">
                                <label class="form-label fw-bold small text-dark">Observaciones:</label>
                                <textarea class="form-control border-warning" id="observacionesGestion" rows="2" placeholder="Notas técnicas o detalles adicionales..."></textarea>
                            </div>
                            <div class="col-12 mt-3">
                                <button type="button" id="btnGuardarGestion" class="btn btn-dark w-100 btn-sm">
                                    <i class="bi bi-save me-2"></i>Guardar Gestión y Actualizar Tabla
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="d-flex justify-content-center align-items-center mt-4 gap-2">
                        <button type="submit" class="btn btn-submit-support">
                            <i class="bi bi-send-check me-2"></i>Enviar Solicitud
                        </button>
                    </div>

                    <!-- Botón Acceso Admin -->
                    <div class="text-center mt-3">
                        <button type="button" id="btnAccesoAdmin" class="btn btn-link btn-sm text-decoration-none text-muted" style="font-size: 0.8rem;">
                            <i class="bi bi-lock-fill"></i> Gestión de Seguimiento
                        </button>
                    </div>
                </form>
            </div>

        </div>
        
        <!-- Footer / Créditos -->
        <footer class="text-center mt-4 mb-4 text-muted small">
            <p class="mb-0 fw-bold">&copy; 2026 Hospital Departamental San Antonio de Roldanillo</p>
            <p class="mb-0">Desarrollado por <span class="text-primary fw-bold">Cristian Ruiz</span></p>
        </footer>
    </div>

    <!-- Modal Manual de Usuario -->
    <div class="modal fade" id="manualModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title"><i class="bi bi-journal-text me-2"></i>Manual de Usuario</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <h6 class="fw-bold text-primary">Instrucciones de Diligenciamiento</h6>
                    <p>Bienvenido al sistema de solicitudes de apertura de historias clínicas. Siga estos pasos:</p>
                    
                    <ol class="list-group list-group-numbered mb-3">
                        <li class="list-group-item"><strong>Datos del Solicitante:</strong> Ingrese su nombre completo y el del profesional que atendió al paciente.</li>
                        <li class="list-group-item"><strong>Información del Paciente:</strong> Digite el documento y nombre del paciente.</li>
                        <li class="list-group-item"><strong>Admisión y Fecha:</strong> 
                            <ul>
                                <li>Si tiene el <em>N° de Admisión</em>, ingréselo (la fecha es opcional).</li>
                                <li>Si NO tiene el número, la <em>Fecha de Atención</em> es obligatoria.</li>
                            </ul>
                        </li>
                        <li class="list-group-item"><strong>Justificación:</strong> Explique detalladamente por qué necesita abrir la historia (ej. error de digitación, nota faltante).</li>
                    </ol>

                    <div class="alert alert-warning small">
                        <i class="bi bi-exclamation-triangle-fill me-1"></i> <strong>Nota:</strong> Todas las solicitudes son auditadas por el área de Sistemas y Calidad.
                    </div>
                </div>
                <div class="modal-footer bg-light">
                    <small class="text-muted me-auto">Versión 1.0 | HDSA</small>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Entendido</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <!-- Lógica JavaScript Personalizada -->
    <script src="scripts.js"></script>
</body>
</html>
